<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Test aggiornamento file via GitHub API</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    textarea { width: 100%; height: 100px; }
    .result { margin-top: 1em; color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Demo aggiornamento file su GitHub</h1>
  <p>Scrivi un messaggio qui sotto e clicca "Aggiorna file":</p>
  <textarea id="contenuto"></textarea><br>
  <button onclick="aggiornaFile()">Aggiorna file sulla repo</button>
  <div id="result" class="result"></div>
  <script>
async function aggiornaFile() {
  const textarea = document.getElementById('contenuto');
  console.log('DEBUG: textarea', textarea); // Puoi lasciarla per vedere se il textarea c’è
  const content = textarea ? textarea.value : null;
  const resultDiv = document.getElementById('result');
  resultDiv.textContent = "Sto aggiornando...";
  resultDiv.className = 'result';

  try {
    const resp = await fetch('https://mensa-cc-backend-cwurz6r1b-devnullccs-projects.vercel.app/api/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: content })
    });

    const data = await resp.json();
    if (resp.ok) {
      resultDiv.textContent = "File aggiornato con successo!";
      resultDiv.className = 'result';
    } else {
      resultDiv.textContent = "Errore backend: " + data.message;
      resultDiv.className = 'result error';
    }
  } catch (e) {
    resultDiv.textContent = "Errore di connessione!";
    resultDiv.className = 'result error';
  }
}
</script>
</body>
</html>
